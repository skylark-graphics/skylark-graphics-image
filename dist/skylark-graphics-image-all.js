/**
 * skylark-graphics-image - The skylark imagex utility library
 * @author Hudaokeji Co.,Ltd
 * @version v0.9.0
 * @link www.skylarkjs.org
 * @license MIT
 */
!function(e,t){var i=t.define,n=t.require,a="function"==typeof i&&i.amd,r=!a&&"undefined"!=typeof exports;if(!a&&!i){var o={};i=t.define=function(e,t,i){"function"==typeof i?(o[e]={factory:i,deps:t.map(function(t){return function(e,t){if("."!==e[0])return e;var i=t.split("/"),n=e.split("/");i.pop();for(var a=0;a<n.length;a++)"."!=n[a]&&(".."==n[a]?i.pop():i.push(n[a]));return i.join("/")}(t,e)}),resolved:!1,exports:null},n(e)):o[e]={factory:null,resolved:!0,exports:i}},n=t.require=function(e){if(!o.hasOwnProperty(e))throw new Error("Module "+e+" has not been defined");var i=o[e];if(!i.resolved){var a=[];i.deps.forEach(function(e){a.push(n(e))}),i.exports=i.factory.apply(t,a)||null,i.resolved=!0}return i.exports}}if(!i)throw new Error("The module utility (ex: requirejs or skylark-utils) is not loaded!");if(function(e,t){e("skylark-langx/_attach",[],function(){return function(e,t,i){"string"==typeof t&&(t=t.split("."));for(var n=t.length,a=e,r=0,o=t[r++];r<n;)a=a[o]=a[o]||{},o=t[r++];return a[o]=i}}),e("skylark-langx/skylark",["./_attach"],function(e){var t={attach:function(i,n){return e(t,i,n)}};return t}),e("skylark-graphics-image/imagex",["skylark-langx/skylark"],function(e){var t={},i=URL||webkitURL;function n(e,i){!e._objectURL||i&&i.noRevoke||(t.revokeObjectURL(e._objectURL),delete e._objectURL)}return t.fetchBlob=function(e,t,i){t()},t.isInstanceOf=function(e,t){return Object.prototype.toString.call(t)==="[object "+e+"]"},t.transform=function(e,t,i,n,a){i(e,a)},t.onerror=function(e,t,i,a,r){n(e,r),a&&a.call(e,t)},t.onload=function(e,i,a,r,o){n(e,o),r&&t.transform(e,o,r,a,{})},t.createObjectURL=function(e){return!!i&&i.createObjectURL(e)},t.revokeObjectURL=function(e){return!!i&&i.revokeObjectURL(e)},t.readFile=function(e,t,i){if(FileReader){var n=new FileReader;if(n.onload=n.onerror=t,n[i=i||"readAsDataURL"])return n[i](e),n}return!1},e.imagex=t}),e("skylark-graphics-image/meta",["./imagex"],function(e){"use strict";var t={},i="undefined"!=typeof Blob&&(Blob.prototype.slice||Blob.prototype.webkitSlice||Blob.prototype.mozSlice);e.blobSlice=i&&function(){var e=this.slice||this.webkitSlice||this.mozSlice;return e.apply(this,arguments)},t.metaDataParsers={jpeg:{65505:[],65517:[]}},t.parseMetaData=function(i,n,a,r){a=a||{},r=r||{};var o=this,s=a.maxMetaDataSize||262144,l=!("undefined"!=typeof DataView&&i&&i.size>=12&&"image/jpeg"===i.type&&e.blobSlice);!l&&e.readFile(e.blobSlice.call(i,0,s),function(e){if(e.target.error)return console.log(e.target.error),void n(r);var i,s,l,f,c=e.target.result,u=new DataView(c),g=2,d=u.byteLength-4,h=g;if(65496===u.getUint16(0)){for(;g<d&&((i=u.getUint16(g))>=65504&&i<=65519||65534===i);){if(s=u.getUint16(g+2)+2,g+s>u.byteLength){console.log("Invalid meta data: Invalid segment size.");break}if(l=t.metaDataParsers.jpeg[i])for(f=0;f<l.length;f+=1)l[f].call(o,u,g,s,r,a);h=g+=s}!a.disableImageHead&&h>6&&(c.slice?r.imageHead=c.slice(0,h):r.imageHead=new Uint8Array(c).subarray(0,h))}else console.log("Invalid JPEG file: Missing JPEG marker.");n(r)},"readAsArrayBuffer")||n(r)},t.hasMetaOption=function(e){return e&&e.meta};var n=e.transform;return e.transform=function(i,a,r,o,s){t.hasMetaOption(a)?t.parseMetaData(o,function(t){n.call(e,i,a,r,o,t)},a,s):n.apply(e,arguments)},e.meta=t}),e("skylark-graphics-image/exif",["./imagex","./meta"],function(e,t){"use strict";var i=function(){};return(i.ExifMap=function(){return this}).prototype.map={Orientation:274},i.ExifMap.prototype.get=function(e){return this[e]||this[this.map[e]]},i.getExifThumbnail=function(e,t,i){if(i&&!(t+i>e.byteLength))return loadImage.createObjectURL(new Blob([e.buffer.slice(t,t+i)]));console.log("Invalid Exif data: Invalid thumbnail data.")},(i.exifTagTypes={1:{getValue:function(e,t){return e.getUint8(t)},size:1},2:{getValue:function(e,t){return String.fromCharCode(e.getUint8(t))},size:1,ascii:!0},3:{getValue:function(e,t,i){return e.getUint16(t,i)},size:2},4:{getValue:function(e,t,i){return e.getUint32(t,i)},size:4},5:{getValue:function(e,t,i){return e.getUint32(t,i)/e.getUint32(t+4,i)},size:8},9:{getValue:function(e,t,i){return e.getInt32(t,i)},size:4},10:{getValue:function(e,t,i){return e.getInt32(t,i)/e.getInt32(t+4,i)},size:8}})[7]=i.exifTagTypes[1],i.getExifValue=function(e,t,n,a,r,o){var s,l,f,c,u,g,d=i.exifTagTypes[a];if(d){if(s=d.size*r,!((l=s>4?t+e.getUint32(n+8,o):n+8)+s>e.byteLength)){if(1===r)return d.getValue(e,l,o);for(f=[],c=0;c<r;c+=1)f[c]=d.getValue(e,l+c*d.size,o);if(d.ascii){for(u="",c=0;c<f.length&&"\0"!==(g=f[c]);c+=1)u+=g;return u}return f}console.log("Invalid Exif data: Invalid data offset.")}else console.log("Invalid Exif data: Invalid tag type.")},i.parseExifTag=function(e,t,n,a,r){var o=e.getUint16(n,a);r.exif[o]=i.getExifValue(e,t,n,e.getUint16(n+2,a),e.getUint32(n+4,a),a)},i.parseExifTags=function(e,t,i,n,a){var r,o,s;if(i+6>e.byteLength)console.log("Invalid Exif data: Invalid directory offset.");else{if(r=e.getUint16(i,n),!((o=i+2+12*r)+4>e.byteLength)){for(s=0;s<r;s+=1)this.parseExifTag(e,t,i+2+12*s,n,a);return e.getUint32(o,n)}console.log("Invalid Exif data: Invalid directory size.")}},i.parseExifData=function(e,t,n,a,r){if(!r.disableExif){var o,s,l,f=t+10;if(1165519206===e.getUint32(t+4))if(f+8>e.byteLength)console.log("Invalid Exif data: Invalid segment size.");else if(0===e.getUint16(t+8)){switch(e.getUint16(f)){case 18761:o=!0;break;case 19789:o=!1;break;default:return void console.log("Invalid Exif data: Invalid byte alignment marker.")}42===e.getUint16(f+2,o)?(s=e.getUint32(f+4,o),a.exif=new i.ExifMap,(s=i.parseExifTags(e,f,f+s,o,a))&&!r.disableExifThumbnail&&(s=i.parseExifTags(e,f,f+s,o,l={exif:{}}),l.exif[513]&&(a.exif.Thumbnail=i.getExifThumbnail(e,f+l.exif[513],l.exif[514]))),a.exif[34665]&&!r.disableExifSub&&i.parseExifTags(e,f,f+a.exif[34665],o,a),a.exif[34853]&&!r.disableExifGps&&i.parseExifTags(e,f,f+a.exif[34853],o,a)):console.log("Invalid Exif data: Missing TIFF marker.")}else console.log("Invalid Exif data: Missing byte alignment offset.")}},t.metaDataParsers.jpeg[65505].push(i.parseExifData),e.exif=i}),e("skylark-graphics-image/scale",["./imagex"],function(e){"use strict";function t(e,t,i,n,a,r,o,s,l,f){return e.getContext("2d").drawImage(t,i,n,a,r,o,s,l,f),e}return e.scale=function(e,i,n){i=i||{};var a,r,o,s,l,f,c,u,g,d,h,p=document.createElement("canvas"),m=e.getContext||function(e){return e.canvas||e.crop||!!e.aspectRatio}(i)&&p.getContext,x=e.naturalWidth||e.width,v=e.naturalHeight||e.height,b=x,y=v;function k(){var e=Math.max((o||b)/b,(s||y)/y);e>1&&(b*=e,y*=e)}function E(){var e=Math.min((a||b)/b,(r||y)/y);e<1&&(b*=e,y*=e)}m&&(i=function(e,t){var i,n,a,r,o=t.aspectRatio;if(!o)return t;for(n in i={},t)t.hasOwnProperty(n)&&(i[n]=t[n]);i.crop=!0,a=e.naturalWidth||e.width,r=e.naturalHeight||e.height,a/r>o?(i.maxWidth=r*o,i.maxHeight=r):(i.maxWidth=a,i.maxHeight=a/o);return i}(e,i),c=i.left||0,u=i.top||0,i.sourceWidth?(l=i.sourceWidth,void 0!==i.right&&void 0===i.left&&(c=x-l-i.right)):l=x-c-(i.right||0),i.sourceHeight?(f=i.sourceHeight,void 0!==i.bottom&&void 0===i.top&&(u=v-f-i.bottom)):f=v-u-(i.bottom||0),b=l,y=f);a=i.maxWidth,r=i.maxHeight,o=i.minWidth,s=i.minHeight,m&&a&&r&&i.crop?(b=a,y=r,(h=l/f-a/r)<0?(f=r*l/a,void 0===i.top&&void 0===i.bottom&&(u=(v-f)/2)):h>0&&(l=a*f/r,void 0===i.left&&void 0===i.right&&(c=(x-l)/2))):((i.contain||i.cover)&&(o=a=a||o,s=r=r||s),i.cover?(E(),k()):(k(),E()));if(m){if((g=i.pixelRatio)>1&&(p.style.width=b+"px",p.style.height=y+"px",b*=g,y*=g,p.getContext("2d").scale(g,g)),(d=i.downsamplingRatio)>0&&d<1&&b<l&&y<f)for(;l*d>b;)p.width=l*d,p.height=f*d,t(p,e,c,u,l,f,0,0,p.width,p.height),c=0,u=0,l=p.width,f=p.height,(e=document.createElement("canvas")).width=l,e.height=f,t(e,p,0,0,l,f,0,0,l,f);return p.width=b,p.height=y,t(p,e,c,u,l,f,0,0,b,y)}return e.width=b,e.height=y,e}}),e("skylark-graphics-image/loadFile",["./imagex"],function(e){"use strict";return e.loadFile=function(t,i,n){var a,r=document.createElement("img");if(r.onerror=function(a){return e.onerror(r,a,t,i,n)},r.onload=function(a){return e.onload(r,a,t,i,n)},"string"==typeof t)return e.fetchBlob(t,function(i){i?(t=i,a=e.createObjectURL(t)):(a=t,n&&n.crossOrigin&&(r.crossOrigin=n.crossOrigin)),r.src=a},n),r;if(e.isInstanceOf("Blob",t)||e.isInstanceOf("File",t))return(a=r._objectURL=e.createObjectURL(t))?(r.src=a,r):e.readFile(t,function(e){var t=e.target;t&&t.result?r.src=t.result:i&&i(e)})}}),e("skylark-graphics-image/main",["./imagex","./meta","./exif","./scale","./loadFile"],function(e){return e}),e("skylark-graphics-image",["skylark-graphics-image/main"],function(e){return e})}(i),!a){var s=n("skylark-langx/skylark");r?module.exports=s:t.skylarkjs=s}}(0,this);
//# sourceMappingURL=sourcemaps/skylark-graphics-image-all.js.map
