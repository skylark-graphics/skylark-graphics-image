{"version":3,"sources":["scale.js"],"names":["define","imagex","renderImageToCanvas","canvas","img","sourceX","sourceY","sourceWidth","sourceHeight","destX","destY","destWidth","destHeight","getContext","drawImage","scale","options","data","maxWidth","maxHeight","minWidth","minHeight","pixelRatio","downsamplingRatio","tmp","document","createElement","useCanvas","crop","aspectRatio","hasCanvasOption","width","naturalWidth","height","naturalHeight","scaleUp","Math","max","scaleDown","min","newOptions","i","hasOwnProperty","getTransformedOptions","left","top","undefined","right","bottom","contain","cover","style"],"mappings":"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","file":"../scale.js","sourcesContent":["define([\r\n  \"./imagex\"\r\n], function(imagex) {\r\n   //The module code is based from blueimp/JavaScript-Load-Image\r\n   // original : https://github.com/blueimp/JavaScript-Load-Image/blob/master/js/load-image-scale.js\r\n   // license  : MIT\r\n\r\n  'use strict'\r\n\r\n  // Transform image coordinates, allows to override e.g.\r\n  // the canvas orientation based on the orientation option,\r\n  // gets canvas, options passed as arguments:\r\n  function transformCoordinates() {\r\n\r\n  }\r\n\r\n  // Returns transformed options, allows to override e.g.\r\n  // maxWidth, maxHeight and crop options based on the aspectRatio.\r\n  // gets img, options passed as arguments:\r\n  function getTransformedOptions(img, options) {\r\n    var aspectRatio = options.aspectRatio\r\n    var newOptions\r\n    var i\r\n    var width\r\n    var height\r\n    if (!aspectRatio) {\r\n      return options\r\n    }\r\n    newOptions = {}\r\n    for (i in options) {\r\n      if (options.hasOwnProperty(i)) {\r\n        newOptions[i] = options[i]\r\n      }\r\n    }\r\n    newOptions.crop = true\r\n    width = img.naturalWidth || img.width\r\n    height = img.naturalHeight || img.height\r\n    if (width / height > aspectRatio) {\r\n      newOptions.maxWidth = height * aspectRatio\r\n      newOptions.maxHeight = height\r\n    } else {\r\n      newOptions.maxWidth = width\r\n      newOptions.maxHeight = width / aspectRatio\r\n    }\r\n    return newOptions\r\n  }\r\n\r\n  // Canvas render method, allows to implement a different rendering algorithm:\r\n  function renderImageToCanvas(\r\n    canvas,\r\n    img,\r\n    sourceX,\r\n    sourceY,\r\n    sourceWidth,\r\n    sourceHeight,\r\n    destX,\r\n    destY,\r\n    destWidth,\r\n    destHeight\r\n  ) {\r\n    canvas\r\n      .getContext('2d')\r\n      .drawImage(\r\n        img,\r\n        sourceX,\r\n        sourceY,\r\n        sourceWidth,\r\n        sourceHeight,\r\n        destX,\r\n        destY,\r\n        destWidth,\r\n        destHeight\r\n      )\r\n    return canvas\r\n  }\r\n\r\n  // Determines if the target image should be a canvas element:\r\n  function hasCanvasOption(options) {\r\n    return options.canvas || options.crop || !!options.aspectRatio\r\n  }\r\n\r\n  // Scales and/or crops the given image (img or canvas HTML element)\r\n  // using the given options.\r\n  // Returns a canvas object if the browser supports canvas\r\n  // and the hasCanvasOption method returns true or a canvas\r\n  // object is passed as image, else the scaled image:\r\n   function scale(img, options, data) {\r\n    options = options || {}\r\n    var canvas = document.createElement('canvas')\r\n    var useCanvas =\r\n      img.getContext ||\r\n      (hasCanvasOption(options) && canvas.getContext)\r\n    var width = img.naturalWidth || img.width;\r\n    var height = img.naturalHeight || img.height;\r\n    var destWidth = width;\r\n    var destHeight = height;\r\n    var maxWidth\r\n    var maxHeight\r\n    var minWidth\r\n    var minHeight\r\n    var sourceWidth\r\n    var sourceHeight\r\n    var sourceX\r\n    var sourceY\r\n    var pixelRatio\r\n    var downsamplingRatio\r\n    var tmp\r\n    function scaleUp () {\r\n      var scale = Math.max(\r\n        (minWidth || destWidth) / destWidth,\r\n        (minHeight || destHeight) / destHeight\r\n      )\r\n      if (scale > 1) {\r\n        destWidth *= scale\r\n        destHeight *= scale\r\n      }\r\n    }\r\n    function scaleDown () {\r\n      var scale = Math.min(\r\n        (maxWidth || destWidth) / destWidth,\r\n        (maxHeight || destHeight) / destHeight\r\n      )\r\n      if (scale < 1) {\r\n        destWidth *= scale\r\n        destHeight *= scale\r\n      }\r\n    }\r\n    if (useCanvas) {\r\n      options = getTransformedOptions(img, options, data)\r\n      sourceX = options.left || 0\r\n      sourceY = options.top || 0\r\n      if (options.sourceWidth) {\r\n        sourceWidth = options.sourceWidth\r\n        if (options.right !== undefined && options.left === undefined) {\r\n          sourceX = width - sourceWidth - options.right\r\n        }\r\n      } else {\r\n        sourceWidth = width - sourceX - (options.right || 0)\r\n      }\r\n      if (options.sourceHeight) {\r\n        sourceHeight = options.sourceHeight\r\n        if (options.bottom !== undefined && options.top === undefined) {\r\n          sourceY = height - sourceHeight - options.bottom\r\n        }\r\n      } else {\r\n        sourceHeight = height - sourceY - (options.bottom || 0)\r\n      }\r\n      destWidth = sourceWidth\r\n      destHeight = sourceHeight\r\n    }\r\n    maxWidth = options.maxWidth\r\n    maxHeight = options.maxHeight\r\n    minWidth = options.minWidth\r\n    minHeight = options.minHeight\r\n    if (useCanvas && maxWidth && maxHeight && options.crop) {\r\n      destWidth = maxWidth\r\n      destHeight = maxHeight\r\n      tmp = sourceWidth / sourceHeight - maxWidth / maxHeight\r\n      if (tmp < 0) {\r\n        sourceHeight = maxHeight * sourceWidth / maxWidth\r\n        if (options.top === undefined && options.bottom === undefined) {\r\n          sourceY = (height - sourceHeight) / 2\r\n        }\r\n      } else if (tmp > 0) {\r\n        sourceWidth = maxWidth * sourceHeight / maxHeight\r\n        if (options.left === undefined && options.right === undefined) {\r\n          sourceX = (width - sourceWidth) / 2\r\n        }\r\n      }\r\n    } else {\r\n      if (options.contain || options.cover) {\r\n        minWidth = maxWidth = maxWidth || minWidth\r\n        minHeight = maxHeight = maxHeight || minHeight\r\n      }\r\n      if (options.cover) {\r\n        scaleDown()\r\n        scaleUp()\r\n      } else {\r\n        scaleUp()\r\n        scaleDown()\r\n      }\r\n    }\r\n    if (useCanvas) {\r\n      pixelRatio = options.pixelRatio\r\n      if (pixelRatio > 1) {\r\n        canvas.style.width = destWidth + 'px'\r\n        canvas.style.height = destHeight + 'px'\r\n        destWidth *= pixelRatio\r\n        destHeight *= pixelRatio\r\n        canvas.getContext('2d').scale(pixelRatio, pixelRatio)\r\n      }\r\n      downsamplingRatio = options.downsamplingRatio\r\n      if (\r\n        downsamplingRatio > 0 &&\r\n        downsamplingRatio < 1 &&\r\n        destWidth < sourceWidth &&\r\n        destHeight < sourceHeight\r\n      ) {\r\n        while (sourceWidth * downsamplingRatio > destWidth) {\r\n          canvas.width = sourceWidth * downsamplingRatio\r\n          canvas.height = sourceHeight * downsamplingRatio\r\n          renderImageToCanvas(\r\n            canvas,\r\n            img,\r\n            sourceX,\r\n            sourceY,\r\n            sourceWidth,\r\n            sourceHeight,\r\n            0,\r\n            0,\r\n            canvas.width,\r\n            canvas.height\r\n          )\r\n          sourceX = 0\r\n          sourceY = 0\r\n          sourceWidth = canvas.width\r\n          sourceHeight = canvas.height\r\n          img = document.createElement('canvas')\r\n          img.width = sourceWidth\r\n          img.height = sourceHeight\r\n          renderImageToCanvas(\r\n            img,\r\n            canvas,\r\n            0,\r\n            0,\r\n            sourceWidth,\r\n            sourceHeight,\r\n            0,\r\n            0,\r\n            sourceWidth,\r\n            sourceHeight\r\n          )\r\n        }\r\n      }\r\n      canvas.width = destWidth\r\n      canvas.height = destHeight\r\n      transformCoordinates(canvas, options)\r\n      return renderImageToCanvas(\r\n        canvas,\r\n        img,\r\n        sourceX,\r\n        sourceY,\r\n        sourceWidth,\r\n        sourceHeight,\r\n        0,\r\n        0,\r\n        destWidth,\r\n        destHeight\r\n      )\r\n    }\r\n    img.width = destWidth\r\n    img.height = destHeight\r\n    return img\r\n  }\r\n\r\n  return imagex.scale = scale;\r\n});"]}